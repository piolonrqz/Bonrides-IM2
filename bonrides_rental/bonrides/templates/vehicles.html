{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Khand:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="{% static 'css/vehicles.css' %}">
    <title>Vehicles</title>
</head>
<body>
    <!-- Navigation -->
    <div class="navbar">
        <div class="nav-left">
            <ul>
                <li><a href="{% url 'about' %}">ABOUT</a></li>
                <li><a href="{% url 'vehicles' %}">VEHICLES</a></li>
                <li><a href="{% url 'booking' %}">BOOKING</a></li>
                <li><a href="{% url 'contacts' %}">CONTACTS</a></li>
            </ul>
        </div>
        <div class="logo">
            <a href="{% url 'homepage' %}" style="color: white; text-decoration: none;">bonrides</a>
        </div>
        <div class="nav-right">
            <ul class="nav_right">
                {% if user.is_authenticated %}
                    <li id="user-format" style="display: inline-block; font-weight: bold; margin-right: 10px;">
                        Hello,
                        <a href="{% url 'edit_profile' %}" style="text-decoration: none; color: yellow;">{{ user.first_name|default:user.email }}</a>!
                    </li>                    
                    <li style="display: inline-block;"><a href="{% url 'logout' %}">LOGOUT</a></li>
                {% else %}
                    <li style="display: inline-block; margin-right: 10px;"><a href="{% url 'login' %}">LOGIN</a></li>
                    <li style="display: inline-block;"><a href="{% url 'register' %}">SIGN UP</a></li>
                {% endif %}
            </ul>
        </div>
    </div>
    </header>
    
    <div class="vehicles-grid">
        {% for vehicle in vehicles %}
            {% if vehicle.availability %}
                <div class="vehicle-card">
                    {% if vehicle.image %}
                    <img src="{{ vehicle.image.url }}" alt="{{ vehicle.model }}" class="vehicle-image">
                    {% else %}
                    <img src="{% static 'images/default-image.jpeg' %}" alt="No image available" class="vehicle-image">
                    {% endif %}
                <div class="year-badge">{{ vehicle.model_year }}</div>
                <div class="vehicle-info">
                    <h3 class="vehicle-name">{{ vehicle.brand }} {{ vehicle.model }}</h3>
                    <div class="price">
                        PHP {{ vehicle.price }} <span>/ DAY</span>
                    </div>
                    <div class="specs">
                        <div class="spec-item">
                            <img src="{% static 'images/mileage.svg' %}" alt="Mileage" class="spec-icon">
                            <span>{{ vehicle.mileage }}</span>
                        </div>
                        <div class="spec-item">
                            <img src="{% static 'images/transmission.svg' %}" alt="Transmission" class="spec-icon">
                            <span>{{ vehicle.get_transmission_display }}</span>
                        </div>
                        <div class="spec-item">
                            <img src="{% static 'images/people.svg' %}" alt="Seats" class="spec-icon">
                            <span>{{ vehicle.seats }}</span>
                        </div>
                    </div>
                    <button class="details-button" onclick="showDetails('{{ vehicle.pk }}')">
                        See Full Details
                    </button>
                </div>
            </div>
        {% endif %}
    {% endfor %}
    </div>

    <!-- Modal -->
    <div id="vehicleModal" class="modal">
        <div class="modal-content">
            <button class="close-modal" onclick="hideModal()">&times;</button>
            <div id="modalContent"></div>
        </div>
    </div>

    <script>
        function showDetails(vehicleId) {
            fetch(`/vehicle-details/${vehicleId}/`)
                .then(response => response.json())
                .then(data => {
                    document.getElementById('modalContent').innerHTML = `
                        <div class=details>
                            <img src="${data.image}" alt="${data.model}" class="modal-image">
                            <br>
                            <div class="details-right">
                                <h2>${data.brand} ${data.model}</h2>
                                <div class="specifications">
                                    <h3>Specifications</h3>
                                    <div class="spec-row">
                                        <span>Mileage</span>
                                        <span>${data.mileage} km</span>
                                    </div>
                                    <div class="spec-row">
                                        <span>Seats</span>
                                        <span>${data.seats}</span>
                                    </div>
                                    <div class="spec-row">
                                        <span>Year</span>
                                        <span>${data.model_year}</span>
                                    </div>
                                    <div class="spec-row">
                                        <span>Brand</span>
                                        <span>${data.brand}</span>
                                    </div>
                                    <div class="spec-row">
                                        <span>Transmission</span>
                                        <span>${data.transmission}</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="book-section">
                            <h3>PHP ${data.price} / DAY</h3>
                            <p>Interested in Renting This Car?</p>
                            <button class="book-button" onclick="location.href='/booking/new'">BOOK</button>
                        </div>
                    `;
                    document.getElementById('vehicleModal').style.display = 'block';
                });
        }

        function hideModal() {
            document.getElementById('vehicleModal').style.display = 'none';
        }

        // Close modal when clicking outside
        window.onclick = function(event) {
            const modal = document.getElementById('vehicleModal');
            if (event.target == modal) {
                hideModal();
            }
        }
    </script>
</body>
</html>
